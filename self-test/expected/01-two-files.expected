
# Rejig files into "example" subdirectory
mkdir example
mv build.jenga fib.c main.c example

# Build from clean
jenga build -a
A: gcc -c fib.c -o fib.o
A: gcc -c main.c -o main.o
A: gcc fib.o main.o -o main.exe
checked 3 targets
ran 3 commands

# Run the built artifact
jenga exec example/main.exe
hello, 55 world

# Rebuild after no changes
jenga build -a
checked 3 targets

# Update main.c "world->UNIVERSE"; two compile actions run
sed -i 's/world/UNIVERSE/g' example/main.c
jenga exec -a example/main.exe
A: gcc -c main.c -o main.o
A: gcc fib.o main.o -o main.exe
hello, 55 UNIVERSE
ran 2 commands

# Reverting to previous state of main.c; no actions run
sed -i 's/UNIVERSE/world/g' example/main.c
jenga exec -a example/main.exe
hello, 55 world

# Whitespace change to main.c; no link action run (early cutoff)
sed -i 's/int main/int      main/g' example/main.c
jenga build -a
A: gcc -c main.c -o main.o
checked 3 targets
ran 1 command

# Update to link under a different name; new link action run
sed -i 's/main.exe/RENAMED.exe/' example/build.jenga
jenga exec -a example/RENAMED.exe
A: gcc fib.o main.o -o RENAMED.exe
hello, 55 world
ran 1 command

# Relocate the example to a new directory; no actions run
mv example RELOCATED
jenga build -a
checked 3 targets

# Duplicate example dir; twice #targets; but no actions run
cp -rp RELOCATED ANOTHER
jenga build -a
checked 6 targets

# Modify one of the example dirs; minimal rebuild as required
sed -i 's/fib(10)/fib(20)/g' RELOCATED/main.c
jenga build -a
A: gcc -c main.c -o main.o
A: gcc fib.o main.o -o RENAMED.exe
checked 6 targets
ran 2 commands

# Run the two co-existing executabls
jenga exec RELOCATED/RENAMED.exe
hello, 6765 world
jenga exec ANOTHER/RENAMED.exe
hello, 55 world

# Materalize all targets in ,jenga; no actions run
jenga build -a --materialize
checked 6 targets
find ,jenga | sort
,jenga
,jenga/ANOTHER
,jenga/ANOTHER/RENAMED.exe
,jenga/ANOTHER/fib.o
,jenga/ANOTHER/main.o
,jenga/RELOCATED
,jenga/RELOCATED/RENAMED.exe
,jenga/RELOCATED/fib.o
,jenga/RELOCATED/main.o

# Remove one directory copy; materalize again in ,jenga
rm -rf RELOCATED
jenga build -a --materialize
checked 3 targets
find ,jenga | sort
,jenga
,jenga/ANOTHER
,jenga/ANOTHER/RENAMED.exe
,jenga/ANOTHER/fib.o
,jenga/ANOTHER/main.o

# Run build again without --materialize; ,jenga is removed
jenga build -a
checked 3 targets
find ,jenga | sort
find: ',jenga': No such file or directory

# Mod some more, try -q
sed -i 's/fib(10)/fib(11)/g' ANOTHER/main.c
jenga build -q
jenga exec -a ANOTHER/RENAMED.exe
hello, 89 world

# Help
jenga --help
jenga: A build system

Usage: jenga.exe (COMMAND | COMMAND | COMMAND | COMMAND | COMMAND | COMMAND)

Available options:
  -h,--help                Show this help text

Available commands:
  build                    Bring a build up to date
  exec                     build; then run a single executable target
  cat                      build; then cat a single target
  install                  build; then install a single executable
  run                      build; then run a list of actions
  test                     build; then run the 'test' action
