
# Rejig files into "example" subdirectory
mkdir example
mv build.jenga fib.c main.c example

# Build from clean
jenga build -a
A: gcc -c main.c -o main.o
A: gcc -c fib.c -o fib.o
A: gcc fib.o main.o -o main.exe
ran 3 commands
checked 3 rules

# Run the built artifact
jenga exec -a example/main.exe
checked 3 rules
hello, 55 world

# Install the artifact
jenga install -a example/main.exe as.exe
checked 3 rules
installed as.exe

# And run that
./as.exe
hello, 55 world

# Rebuild after no changes
jenga build -a
checked 3 rules

# Update main.c "world->UNIVERSE"; two compile actions run
sed -i 's/world/UNIVERSE/g' example/main.c
jenga exec -a example/main.exe
A: gcc -c main.c -o main.o
A: gcc fib.o main.o -o main.exe
ran 2 commands
checked 3 rules
hello, 55 UNIVERSE

# Reverting to previous state of main.c; no actions run
sed -i 's/UNIVERSE/world/g' example/main.c
jenga exec -a example/main.exe
checked 3 rules
hello, 55 world

# Whitespace change to main.c; no link action run (early cutoff)
sed -i 's/int main/int      main/g' example/main.c
jenga build -a
A: gcc -c main.c -o main.o
ran 1 command
checked 3 rules

# Update to link under a different name; new link action run
sed -i 's/main.exe/RENAMED.exe/' example/build.jenga
jenga exec -a example/RENAMED.exe
A: gcc fib.o main.o -o RENAMED.exe
ran 1 command
checked 3 rules
hello, 55 world

# Relocate the example to a new directory; no actions run
mv example RELOCATED
jenga build -a
checked 3 rules

# Duplicate example dir; twice #targets; but no actions run
cp -rp RELOCATED ANOTHER
jenga build -a
checked 6 rules

# Modify one of the example dirs; minimal rebuild as required
sed -i 's/fib(10)/fib(20)/g' RELOCATED/main.c
jenga build -a
A: gcc -c main.c -o main.o
A: gcc fib.o main.o -o RENAMED.exe
ran 2 commands
checked 6 rules

# Run the two co-existing executabls
jenga exec RELOCATED/RENAMED.exe
hello, 6765 world
jenga exec ANOTHER/RENAMED.exe
hello, 55 world

# View the targets
jenga build -t
RELOCATED/main.o
RELOCATED/fib.o
RELOCATED/RENAMED.exe
ANOTHER/main.o
ANOTHER/fib.o
ANOTHER/RENAMED.exe

# Corrupt one build.jenga; see parse error
chmod +w RELOCATED/build.jenga && echo xxx >> RELOCATED/build.jenga
jenga build -a
Build failed for 1 reason:
(1) RELOCATED/build.jenga: failed to parse '\n' at 14'3

# Remove one directory copy; view targets again
rm -rf RELOCATED
jenga build -t
ANOTHER/main.o
ANOTHER/fib.o
ANOTHER/RENAMED.exe

# Mod some more, try -q
sed -i 's/fib(10)/fib(11)/g' ANOTHER/main.c
jenga build -q
jenga exec -a ANOTHER/RENAMED.exe
checked 3 rules
hello, 89 world

# Help
jenga --help
jenga: A build system

Usage: jenga.exe (COMMAND | COMMAND | COMMAND | COMMAND | COMMAND | COMMAND)

Available options:
  -h,--help                Show this help text

Available commands:
  build                    Bring a build up to date
  exec                     build; then run a single executable target
  cat                      build; then cat a single target
  install                  build; then install a single executable
  run                      build; then run a list of actions
  test                     build; then run the 'test' action
