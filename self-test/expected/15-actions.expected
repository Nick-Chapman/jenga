
# Remove the expectation file
rm the.out.expected

# Test; the.out.expected is missing, so failure
jenga test
ran 2 commands
Build failed for 1 reason:
(1) 'the.out.expected' : is not source and has no build rule

# Promote
jenga build -a --promote
A: if [ ! -z "promote" ]; then echo '!the.out.expected : the.out : ln $< $@'; fi > promotion.rule
A: ln the.out the.out.expected
ran 2 commands
checked 3 rules

# Test (now passes)
jenga test -a
A: diff the.out the.out.expected
ran 1 command
checked 2 rules

# Replace the expectation file in place.
# This would provoke a bug if file materialization were implemented using "ln" instead of "cp".
chmod +w the.out.expected
echo 'But I want to see this!' > the.out.expected

# Rerun test; get failure
jenga test -a
A: diff the.out the.out.expected
(directory) .
(rule) *test : the.out the.out.expected
(command) $ diff the.out the.out.expected
1c1
< I am the output!
---
> But I want to see this!
(exit-code) 1
ran 1 command
Build failed for 1 reason:
(1) action failed for rule targeting: *test
